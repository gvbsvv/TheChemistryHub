async function loadMarkdown() {
    const urlParams = new URLSearchParams(window.location.search);
    let file = urlParams.get('file');

    if (!file) {
        document.getElementById("content").innerText = "No file specified.";
        return;
    }

    console.log("Fetching file:", file);

    try {
        // Ensure the file does not include "content/" in the query param
        if (file.startsWith("content/")) {
            file = file.replace("content/", ""); // Remove "content/" if user includes it in the URL
        }

        // GitHub Pages requires a full raw URL
        const rawURL = `https://raw.githubusercontent.com/gvbsvv/TheChemistryHub/main/content/${file}`;

        console.log("Fetching from:", rawURL);

        const response = await fetch(rawURL);
        if (!response.ok) throw new Error(`File not found (Status: ${response.status})`);
        const text = await response.text();

        // Convert markdown to HTML
        const converter = new showdown.Converter();
        let htmlContent = converter.makeHtml(text);

        // Generate Table of Contents
        htmlContent = generateTableOfContents(htmlContent);

        // Set converted content
        document.getElementById("content").innerHTML = htmlContent;

        // Apply syntax highlighting
        document.querySelectorAll("pre code").forEach((block) => {
            hljs.highlightElement(block);
        });

        // Update page title dynamically based on file name
        document.getElementById("page-title").innerText = getFormattedTitle(file);

    } catch (error) {
        console.error("Error loading markdown:", error);
        document.getElementById("content").innerText = "Error loading file. Make sure the file exists.";
    }
}
